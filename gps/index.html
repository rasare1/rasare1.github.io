
<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8">
<title>Mesurador de distàncies</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  table { border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 5px 10px; text-align: center; }
  input { margin-left: 5px; }
  button { margin-top: 10px; }
</style>
</head>
<body>

<h2>Mesurador de Latitud i Longitud</h2>

<button onclick="mesura()">Mesura</button>
  <!--Aquest botó html executa una funció javasript al clicar-se que es troba a la línia 36 que ens 
  permet trobar la nostre latitud i longitut. Onclick es un atribut del html botton que permet unir
  al botó javasrcipt a la function mesura quan fem click al botó-->
<table id="mesuresTable">
  <!-- La línia 23 l'inici d'una taula, però li hem posat una id, perquè? Podria ser per molts motius.
  Primer amb una #mesuresTable¨{propietat1:valor1} podria modificar per exemple els marges de la taula.
  Primer hauriem d'agafar la id amb un #mesuresTable{color:green;margin:20px}.
  A més a més de poder canviar l'estil de la taula amb id únic, podem veur que a la línia 63,
  Gràcies a GetElementbyId, agafo l'dentificador(mesureTable) que abans no feia res, i el transformo 
  en una variable de tipus javascript constant perquè així aconseguim poder-la modificar i afegir una 
  altre variable diferent (row). -->
  <tr>
    <th>#</th>
    <th>Latitud</th>
    <th>Longitud</th>
    <th>Ubicació</th>
  </tr>
</table>

<h3>Distàncies pas a pas</h3>
<div id="distancies"></div>
<!--A la línia 40, tinc un div que és una àrea identificada amb una id, però no visible per defecte
  per l'usuari, la puc fer visibke amb un codi javascript o css o una combinació que canvi la propietat
  visible a hidden o a l inversa-->
<script>
let mesures = [];
/*La línia 45 és un array. Els [] sempre indiquen arrays o conjunt de dades. Ara l'array és buit,
però es important definir-ho buit per a que reservi un espai a la memoria del ordinador per emmagatzemar
diverses dades*/
function mesura() {
  /*La funció mesura la primer que fa és una estructura condicional amb un if, que té un signe 
  d'admiració !(significa negació). El primer if és el condicional que comprova que el objecte navegator de la 
  classe navigatrque té un métode anomenat geolocation està disponible en aquell navegador o no.
  El punt entre navigator i geolocation és molt important, perquè és la sitaxi del punt o dot syntax,
  és a dir el punt separa l'objecte del métode que volem aplicar en aquest. El pun aplica l'acció.
  Si el navegador no pot executar geolocation, haurà de alertar mitjançant un missatge.
  El return el que fa és mostrar el missatge en pantalla.
  Alert és una funció de javascipt que mostra una finestra emergent amn un missatge per a l'usuari,
  és una funció molt senzilla perquè només té argument. Els arguments és el que tenim a dins dels 
  parentesis, si no tenim arguments tenim  els paréntesis buits. L'únic argument és el text que volem 
  mostrar a l'usuari. La finestra emergent obliga a l'usuari a trencar-la. S'utilitza per a missatges 
  simples com avisos, erraors, confirmacións. Hi han altres tipus de finestres emergents més importants i potents
  que s'anomenen modals o finestres emergents modals.  Si hi ha geolocalització no surt la finestra.
  Navegation.geolocation és una API que ens dona la posició 
  latutud i longitut de l'usuri. Aquesta aplicació té una funció principal que és getCurrentPosition
  success/éxit, el segon és error, i trenca el options. LLavors la funció és
  getCurrentPosition(succes,error,position). El primer argument succes é un callback, és un sistema que 
  es crida i que permet obtenitr la posició, i ho fem amb la funció fletcha => tenen una sintaxis simplificada i no utilitza la paraula this
  */
  if (!navigator.geolocation) {
    alert("La geolocalització no és compatible amb aquest navegador.");
    return;
  }

  navigator.geolocation.getCurrentPosition((pos) => {
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;

    const ubicacio = prompt("Indica el lloc on s'ha fet la mesura:");

    mesures.push({lat, lon, ubicacio});
    actualitzaTaula();
    calculaDistancies();
  }, (err) => {
    alert("Error al obtenir la localització: " + err.message);
  });
}

function actualitzaTaula() {
  const table = document.getElementById("mesuresTable");
  // netegem totes les files excepte la capçalera
  table.innerHTML = `
    <tr>
      <th>#</th>
      <th>Latitud</th>
      <th>Longitud</th>
      <th>Ubicació</th>
    </tr>`;
  mesures.forEach((m, i) => {
    const row = table.insertRow();
    row.insertCell(0).textContent = i+1;
    row.insertCell(1).textContent = m.lat.toFixed(6);
    row.insertCell(2).textContent = m.lon.toFixed(6);
    row.insertCell(3).textContent = m.ubicacio;
  });
}

function calculaDistancies() {
  const div = document.getElementById("distancies");
  if (mesures.length < 2) {
    div.innerHTML = "Afegiu almenys dues mesures per calcular distàncies.";
    return;
  }

  let html = "";
  for (let i = 0; i < mesures.length - 1; i++) {
    const p1 = mesures[i];
    const p2 = mesures[i+1];

    // Pitàgores (aproximació)
    const dx = (p2.lon - p1.lon) * Math.cos((p1.lat + p2.lat)/2 * Math.PI/180) * 111.32; // km
    const dy = (p2.lat - p1.lat) * 110.574; // km
    const distPitag = Math.sqrt(dx*dx + dy*dy);

    // Haversine
    const R = 6371; // radi de la Terra en km
    const dLat = (p2.lat - p1.lat) * Math.PI/180;
    const dLon = (p2.lon - p1.lon) * Math.PI/180;
    const a = Math.sin(dLat/2)**2 + Math.cos(p1.lat*Math.PI/180)*Math.cos(p2.lat*Math.PI/180)*Math.sin(dLon/2)**2;
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    const distHav = R * c;

    html += `
      <p><b>${i+1} → ${i+2}:</b> ${p1.ubicacio} → ${p2.ubicacio} <br>
      Pitàgores: ${distPitag.toFixed(3)} km, Haversine: ${distHav.toFixed(3)} km</p>`;
  }

  div.innerHTML = html;
}
</script>

</body>
</html>
